/*
Automatically execute actions on torrents based off custom rules

Each array of objects is a set of rules that must all match for an action to be executed.
Treat the parent array (array of arrays) as an OR condition, and each object under IF as an AND condition.

To specify IS/IS NOT and greater/lesser than conditions, use the "direction" field.
For example to match a boolean (true/false) field, use "ASC" to delete if false, and "DESC" to delete if true.
To match a threshold (number) field, use "ASC" to delete if less than the threshold, and "DESC" to delete if greater than the threshold.

Rules will be executed in order. When chaining many rules together, place the most specific rules first. E.g. if you auto resume torrents then later later delete stopped torrents, place the resume rule first.
*/

[
	// Resume completed torrents that are stopped
	{
		"if": [
			{ "key": "state", "includes": ["stoppedUP"], "direction": "DESC" }
		],
		"then": "start"
	},
	// Resume almost finished torrents that are stopped
	{
		"if": [
			{ "key": "state", "includes": ["stoppedDL"], "direction": "DESC" },
			{ "key": "progress", "direction": "DESC", "threshold": 0.95 }
		],
		"then": "start"
	},
	// Recheck missing files
	{
		"if": [
			{ "key": "state", "includes": ["missingFiles"], "direction": "DESC" }
		],
		"then": "recheck"
	},
	// Remove errored cross-seed-links
	{
		"if": [
			{ "key": "category", "includes": ["cross-seed-links"], "direction": "DESC" },
			{ "key": "state", "includes": ["error"], "direction": "DESC" }
		],
		"then": "delete"
	},
	// Recheck errored torrents
	// {
	// 	"if": [
	// 		{ "key": "state", "includes": ["error"], "direction": "DESC" }
	// 	],
	// 	"then": "recheck"
	// },
	// Remove cross-seed-links that have less than 95% progress
	{
		"if": [
			{ "key": "category", "includes": ["cross-seed-links"], "direction": "DESC" },
			{ "key": "progress", "direction": "ASC", "threshold": 0.95 },
			{ "key": "state", "includes": ["checkingDL", "checkingUP"], "direction": "ASC" }
		],
		"then": "delete"
	},
	// Force disable sequential downloads on all torrents
	{
		"if": [
			{ "key": "seq_dl", "direction": "DESC" }
		],
		"then": "toggleSequentialDownload"
	},
	// Force enable auto torrent management mode for non cross-seed torrents
	{
		"if": [
			{ "key": "auto_tmm", "direction": "ASC" },
			{ "key": "tags", "includes": ["cross-seed"], "direction": "ASC" }
		],
		"then": "setAutoManagement",
		"arg": true
	},
	// Remove Public Torrents
	{
		"if": [
			// RuTracker torrents are marked as public and new trackers have "Public Tracker" so we should catch both
			{ "key": "tags", "includes": ["Public Tracker"], "direction": "DESC" },
			{ "key": "private", "direction": "ASC" },
			{ "key": "state", "includes": ["stalledUP", "stoppedUP", "uploading"], "direction": "DESC" },
			{ "key": "num_complete", "direction": "ASC", "threshold": 5 }
		],
		"then": "delete"
	}
]
